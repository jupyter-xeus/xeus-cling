jobs:
  - job: 'OSX'
    strategy:
      matrix:
        macOS_12:
          image_name: 'macOS-12'
    pool:
      vmImage: $(image_name)
    variables:
        CC: clang
        CXX: clang++
    timeoutInMinutes: 30
    steps:
      - script: |
          echo "Checking existence of /Library/Developer/CommandLineTools/SDKs/"
          ls /Library/Developer/CommandLineTools/SDKs/
          echo "Checking existence of /Applications/Xcode.app/Contents/Developer"
          ls /Applications/Xcode.app/Contents/Developer/
          echo "Checking existence of /Applications/Xcode_14.0.1.app"
          ls /Applications/Xcode_14.0.1.app
        displayName: checking SDKs paths

      - script: |
          echo "Removing homebrew for Azure to avoid conflicts with conda"
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall.sh)"
        displayName: Remove homebrew

      - bash: |
          echo "##vso[task.prependpath]$CONDA/bin"
          sudo chown -R $USER $CONDA
        displayName: Add conda to PATH

      - template: unix-build.yml
        parameters:
          platform: 'OSX'
